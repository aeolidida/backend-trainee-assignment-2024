FROM --platform=linux/amd64 golang:1.22.1-alpine3.19 AS builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .
ENV CONFIG_PATH=${CONFIG_PATH} \
    DB_USER=${DB_USER} \
    DB_PASSWORD=${DB_PASSWORD} \
    AUTH_SECRET_KEY=${AUTH_SECRET_KEY} \
    REDIS_PASSWORD=${REDIS_PASSWORD} \
    RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER} \
    RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS} 
    
EXPOSE 8080

CMD ["/bin/sh"]